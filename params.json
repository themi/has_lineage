{"name":"Has lineage","tagline":"Hybrid hierarchy - Adjacency and Materialised Path ","body":"# HasLineage\r\n\r\nA gem to manage hierarchical data.  This gem uses the Adjacency pattern to form the relationship and Materialised Path pattern for lookup.\r\n\r\nI used this project as a training exercise to create a gem for a Rails project.  As a training project, it is not full featured and currently is not my intention to make it so. Though as its creator I will keep an open communication line to this project - contact me with your feedback.\r\n\r\nThe strategies I selected were from a an earlier project (15years ago) that appeared to me as being efficient.  The reason Materialised Path is fast for _lookup_ is that it uses an ordered btree index on the records ancestry line.\r\n\r\nSo whats the best? Well in researching this subject I have found the following startegies for handling hierarchical data:\r\n\r\n#### Adjacency List\r\n* Each record has a key to its immediate parent.\r\n\r\n#### Materialised Path / Path Enumeration\r\n* Each record has a field containing complete line of its ancestry all the way up to the root.\r\n\r\n#### Nested Sets.\r\n* Each record has keys to the record immediatly left and right of its position the hierarchical chain.\r\n\r\n#### Closure Table\r\n* The complete line of its ancestry all the way up to the root is maintained as separate records in a separate table.\r\n\r\n## How do they stack up against each other\r\n\r\nPlenty of smarter people than I have already done this - take a look:\r\n\r\n* [Taxonomic Trees in PostgreSQL](http://gbif.blogspot.com.au/2012/06/taxonomic-trees-in-postgresql.html)\r\n* [Models for hierarchical data by Bill Karwin](http://www.slideshare.net/billkarwin/models-for-hierarchical-data)\r\n* [Trees In The Database - Advanced data structures by Lorenzo Alberton](http://www.slideshare.net/quipo/trees-in-the-database-advanced-data-structures)\r\n\r\n## Summary\r\n\r\nEach one has its own particular strengths and your choice should be guided by how you are using your data/tree.  Me, I am leaning toward Closure Table as it separates the admin from the actual data file and sets you up to take advantage an ordered btree index (like Materialised Path does).\r\n\r\n## Other gems\r\n\r\nIf there are others that I havent listed here please let me know and I'll add them.\r\n\r\n* [Ancestry](https://github.com/stefankroes/ancestry)\r\n* [Use PostgreSQL LTREE type with ActiveRecord](https://github.com/RISCfuture/hierarchy)\r\n* [Closure Tree](https://github.com/mceachen/closure_tree)\r\n* [Acts as tree for Rails 3](https://github.com/kristianmandrup/acts_as_tree_rails3)\r\n\r\n## Installation\r\n\r\nAdd this line to your application's Gemfile:\r\n\r\n    gem 'has_lineage'\r\n\r\nAnd then execute:\r\n\r\n    $ bundle\r\n\r\nOr install it yourself as:\r\n\r\n    $ gem install has_lineage\r\n\r\n## Usage\r\n\r\n#### Run migration\r\n\r\n```bash\r\nrails generate has_lineage:migration Post\r\n```\r\n\r\nadjust the migration file as required, then...\r\n\r\n```bash\r\nrake db:migrate\r\n```\r\n\r\n#### Add to your model\r\n\r\n```ruby\r\nclass Post < ActiveRecord::Base\r\n  include HasLineage\r\n  has_lineage\r\nend\r\n\r\n```\r\n\r\n#### Setup your tree\r\n\r\n```ruby\r\nharry = Post.create(:name => \"Harry\")\r\nmary = Post.create(:name => \"Mary\")\r\njohn = Post.create(:name => \"John\")\r\njane = Post.create(:name => \"Jane\")\r\nlarry = Post.create(:name => \"Larry\")\r\ngina = Post.create(:name => \"Gina\")\r\nPost.reset_lineage_tree do\r\n  harry.children << mary\r\n  harry.children << john\r\n  harry.children << jane\r\n  john.children << larry\r\n  john.children << gina\r\nend\r\n```\r\n\r\nI have not included call_backs to update tree automatically, as maintaining indexes on the lineage path column can be expensive.  Updating the tree should a be a process on its own and once done editing, then reset the tree/s.\r\n\r\n### Navigating\r\n\r\n```\r\nroot             Returns the root of the tree the record is in, self for a root node\r\nparent           Returns the parent of the record, nil for a root node\r\nancestors        Returns a list of ancestors of the record, self is not included\r\nchildren         Returns children of the record\r\nsiblings         Returns siblings of the record, the record itself is not included\r\ndescendants      Returns direct and indirect children of the record, self is not included\r\n```\r\n\r\n```\r\nchildren?                   are there any children for this record\r\nparent?                     is there a parent record for this record\r\nupdate_children_recursive   reset the tree from the record's parent down to last descendant\r\nmove_to(destination_parent) move this record to another.  Also updates bothe source and \r\n                            destination tress\r\n```\r\n\r\n```\r\nKlass.reset_lineage_tree    Reset the entire tree\r\n```\r\n\r\n\r\n### Options for has_lineage\r\n\r\n```\r\n:parent_key       foreign key to the parent record, defaults to :parent_id\r\n:lineage_column   column_name storing the ancestry path, defaults to :lineage \r\n:leaf_width       the length of each ancestry path key, defaults to 4.\r\n                  4 means: max siblings 9999, ~ max tree depth of 51 levels. \r\n:delimiter        the path separtor, defaults to '/'\r\n:branch_key       foreign key to separate trees, defaults to nil (no separation).\r\n                  use this option to add another foreign key so as to categorize \r\n                  or differentiate trees.\r\n:order            column name used to order the siblings, defaults to nil \r\n:counter_cache    true/false, defaults to false. use to use Rails counter_cache\r\n                  if true must add field :lineage_children_count to table\r\n```\r\n\r\n## Contributing\r\n\r\n1. Fork it\r\n2. Create your feature branch (`git checkout -b my-new-feature`)\r\n3. Commit your changes (`git commit -am 'Add some feature'`)\r\n4. Push to the branch (`git push origin my-new-feature`)\r\n5. Create new Pull Request\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}